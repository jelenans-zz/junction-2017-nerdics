{"version":3,"file":"patch-angular-compiler-cli.js","sourceRoot":"","sources":["../../src/patch-angular-compiler-cli.ts"],"names":[],"mappings":";;AAAA;;;GAGG;AACH,+BAAiC;AACjC,iCAA+B;AAC/B,IAAM,gBAAgB,GAAG,OAAO,CAAC,0DAA0D,CAAC,CAAC;AAE7F,mBAAmB,IAAa;IAC9B,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;QACjB,IAAM,QAAQ,GAAkB,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;QACzD,EAAE,CAAC,CAAC,QAAQ,KAAK,IAAI,IAAI,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;YACzC,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC;YAC9B,EAAE,CAAC,YAAY,CAAC,IAAI,EAAE,SAAS,CAAC,CAAA;QAClC,CAAC;IACH,CAAC;AACH,CAAC;AAED,IAAM,qCAAqC,GAAG,gBAAgB,CAAC,qCAAqC,CAAC;AACrG,gBAAgB,CAAC,qCAAqC,GAAG,UAAS,WAAW,EAAE,OAAO;IACpF,IAAM,EAAE,GAAG,qCAAqC,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;IACvE,MAAM,CAAC,UAAA,OAAO,IAAI,OAAA,UAAA,UAAU;QAC1B,IAAM,MAAM,GAAG,EAAE,CAAC,OAAO,CAAC,CAAC,UAAU,CAAC,CAAC;QACvC,EAAE,CAAC,CAAC,MAAM,KAAK,UAAU,CAAC,CAAC,CAAC;YAC1B,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,SAAS,CAAC,CAAA;QACpC,CAAC;QACD,MAAM,CAAC,MAAM,CAAC;IAChB,CAAC,EANiB,CAMjB,CAAC;AACJ,CAAC,CAAC","sourcesContent":["/**\n * This module will patch the `@angular/compiler-cli` so it will correctly lower expression to declarations in decorators.\n * See https://github.com/angular/angular/issues/20216\n */\nimport * as ts from 'typescript';\nimport '@angular/compiler-cli';\nconst lowerExpressions = require('@angular/compiler-cli/src/transformers/lower_expressions');\n\nfunction touchNode(node: ts.Node) {\n  if (!node.parent) {\n    const original: ts.Node = <any> ts.getOriginalNode(node);\n    if (original !== node && original.parent) {\n      node.parent = original.parent;\n      ts.forEachChild(node, touchNode)\n    }\n  }\n}\n\nconst getExpressionLoweringTransformFactory = lowerExpressions.getExpressionLoweringTransformFactory;\nlowerExpressions.getExpressionLoweringTransformFactory = function(requestsMap, program) {\n  const fn = getExpressionLoweringTransformFactory(requestsMap, program);\n  return context => sourceFile => {\n    const result = fn(context)(sourceFile);\n    if (result !== sourceFile) {\n      ts.forEachChild(result, touchNode)\n    }\n    return result;\n  };\n};\n"]}